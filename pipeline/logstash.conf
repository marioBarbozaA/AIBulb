input { 
  mongodb {
    uri => "mongodb://10.0.0.4/disponibles?ssl=true"
    placeholder_db_dir => "/usr/share/logstash/"
    placeholder_db_name => "logstash_sqlite.db"
    collection => "servicios"
    batch_size => 5000
  }
}

filter {
  json {
    source => "message"
  }
  
  if "_jsonparsefailure" in [tags] {
    drop {}
  }
  
  if [status] == "Exitoso" {
    mutate {
      remove_field => ["@version", "@timestamp", "log", "host", "file", "path", "Respuesta", "idConversacion","estado","serviciosEncontrados","logo","prompt"
      ,"geolocalizacion","event","ubicacionActual","tieneSuscripcion"]
      add_field => {
        "nombre" => "%{[serviciosEncontrados][0][nombre]}"
        "hour" => "%{[hora]}"
        "date" => "%{[fecha]}"
        "estatus" => "%{[status]}"
        "montos" => "%{[monto]}"
        "tipoRequests" => "%{[tipoRequest]}"
        "pais" => "%{[ubicacionActual][pais]}"
      }
       remove_field => ["serviciosEncontrados", "hora", "fecha", "status", "monto", "tipoRequest", "ubicacionActual"]
    }
  } else {
    drop {}
  }
}

output {
  stdout {
    codec => rubydebug
  }
}
